type: Test
spec:
  id: e2e-custom-headers-custom-mode
  name: e2e-custom-headers-custom-mode
  description: Test custom trace header propagation in custom mode
  trigger:
    type: http
    httpRequest:
      url: custom-headers:8080/test
      method: GET
      headers:
        - key: X-Correlation-ID
          value: abc12300000000000000000000000000-abc1230000000000-01

  specs:
    - name: Check main span exists with correct trace ID from custom header
      selector: span[tracetest.span.type="http" name="GET /test"]
      assertions:
        - attr:http.method  =  "GET"
        - attr:http.status_code  =  200
        - attr:tracetest.span.name = "GET /test"
        # Verify the trace ID matches what was in X-Correlation-ID header
        - attr:trace_id = "abc12300000000000000000000000000"
    
    - name: Check custom header was received
      selector: span[tracetest.span.type="http"]
      assertions:
        - attr:http.request.header.x-correlation-id contains "abc12300000000000000000000000000"
